<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>Screem</title>
  <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.css">

  <link rel="shortcut icon" type="image/png" href="assets/pictures/steem.png"/>

  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script src="steemjs-lib.min.js"></script>
  <script src="semantic/dist/semantic.js"></script>
  <script>
  $(document).ready(function(){
      $('.menu .item').tab();
  });

  </script>
  <style>
    .last.container {
      margin-bottom: 300px !important;
    }
    h1.ui.center.header {
      margin-top: 3em;
    }
    h2.ui.center.header {
      margin: 4em 0em 2em;
    }
    h3.ui.center.header {
      margin-top: 2em;
      padding: 2em 0em;
    }
  </style>
</head>
<body>
<script>

const options = {
    // user: "username",
    // pass: "password",
    // url: "ws://127.0.0.1:8090",
    apis: ["database_api", "network_broadcast_api"],
    url: "wss://this.piston.rocks"
};

function login(){
  var username = document.getElementById("user").value;
  var password = document.getElementById("pass").value;
  var login = new window.steemJS.Login();
  var Api = window.steemJS.steemRPC.Client.get(options, true);
  Api.initPromise.then(function(res){
    Api.database_api().exec("get_accounts", [[username]]).then(function(res) {
      var account = res[0];
      login.setRoles(["posting"]);
      try{
        let success = login.checkKeys({
            accountName: username,
            password: password,
            auths: {
                owner: account.owner.key_auths,
                active: account.active.key_auths,
                posting: account.posting.key_auths
            }});
            if(success){ // we're in.
              document.getElementById("errors").innerHTML = '<div class="ui green basic label">Success</div>';
              var atag = document.getElementById("loginButton");
              atag.parentNode.removeChild(atag);
            }
            else{ // user entered the wrong credentials.
              document.getElementById("errors").innerHTML = '<div class="ui red basic label">Error: Incorrect username or password</div>';
            }
        }
        catch(err){
          document.getElementById("errors").innerHTML = '<div class="ui red basic label">'.concat(err).concat('</div>');
        }
    });
  });
}
</script>
<div class="ui pointing borderless menu">
  <div class="item">
    <img src="assets/pictures/steemicon.png">
  </div>
  <div class="left menu">
    <a class="item active" data-tab="first">Discover</a>
    <a class="item" data-tab="second">Feed</a>
    <a class="item" data-tab="third">Followers</a>
  </div>

  <div class="right menu">
    <div class="item">
      <div class="ui icon transparent large input">
        <input type="text" placeholder="Search">
        <i class="search link icon"></i>
      </div>
    </div>
    <a class="item" data-tab="fourth" id="loginButton" >Sign in</a>
  </div>
</div>
<div class="ui grid">
  <div class="two wide column"></div>
  <div class="twelve wide column">
    <div class="ui tab active" data-tab="first">
      <div class="ui fluid icon input testing">
        <input type="text" placeholder="Tell us how you really feel">
        <i class="send icon"></i>
      </div>
      <script>
      $.getJSON( "https://api.steemjs.com/getState?path=/hot/funny", function( data ) {
        $.each( data['content'], function( key, val ) {
          $(".discovertweets").prepend('\
          <div class="ui fluid card">\
            <div class="content">\
              <img class="right floated mini ui image" src="assets/pictures/default_profile.png">\
              <div class="header">\
              '.concat(val['author']).concat('\
              </div>\
              <div class="meta">\
                Posted 34 seconds ago.\
              </div>\
              <div class="description">\
          ').concat(val['title']).concat('\
          </div>\
          </div>\
          <div class="extra content">\
          <div class="basic right floated circular label"><i class="dollar icon"></i>').concat(val['total_pending_payout_value']).concat('</div>\
          <div class="ui left floated labeled button" tabindex="0">\
            <div class="ui red mini button">\
              <i class="heart icon"></i> Like\
            </div>\
            <a class="ui basic red left pointing label">\
          ').concat(val['net_votes']).concat('\
          </a>\
        </div>\
        </div>\
        </div>\
          '));
        });
      });
      </script>
      <br />
      <div class="discovertweets">

      </div>
      <!--<div class="ui active centered inline loader"></div>-->
    </div>

    <div class="ui tab" data-tab="second">
      <div class="ui fluid card">
        <div class="content">
          Second
        </div>
      </div>
    </div>

    <div class="ui tab" data-tab="third">
      <div class="ui fluid card">
        <div class="content">
          Third
        </div>
      </div>
    </div>

    <div class="ui tab" data-tab="fourth">
      <div class="ui fluid card">
        <div class="content">
          <form class="ui form">
            <div class="field">
              <label>Username</label>
              <input type="text" id="user" placeholder="Username">
            </div>
            <div class="field">
              <label>Password</label>
              <input type="password" id="pass" placeholder="Password">
            </div>
            <div class="field">
              <div class="ui checkbox" id="errors">
              </div>
            </div>
            <button class="ui button" type="button" onclick="login()">Login</button>
          </form>
        </div>
      </div>
    </div>
  <div class="two wide column"></div>
</div>




</body>
</html>
